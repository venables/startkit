#!/usr/bin/env sh

#
# Install dependencies
#
echo "âœ¨ Installing dependencies ..."
pnpm install --frozen-lockfile

#
# Create a .env.local file and popupate it with auto-generated secrets
#
if ! [ -f .env.local ]; then
  echo "\nâœ¨ Creating a .env.local file for local environment variables..."
  touch .env.local

  echo "\nâœ¨ Generating a secure value for local NEXTAUTH_SECRET ..."
  echo "NEXTAUTH_SECRET=\"$(openssl rand -base64 32)\"" >> .env.local
  echo "NEXTAUTH_URL=\"http://localhost:3000\"" >> .env.local
fi


#
# Create the database and run any outstanding migrations
#
echo "\nâœ¨ Ensuring the 'postgres' user exists..."
createuser -s postgres

echo "\nâœ¨ Creating the local database 'startkit_development'..."
createdb -U postgres startkit_development

echo "\nâœ¨ Migrating the database..."
pnpm db:migrate

#
# Done.
#
echo "\nðŸŽ‰ All set. Happy coding!"
